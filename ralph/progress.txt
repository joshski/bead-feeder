# Progress Log

## 2026-01-13: Initialize Vite React TypeScript project (bead-feeder-qdp)

Set up Vite + React + TypeScript project with:
- Added vite, react, react-dom, @vitejs/plugin-react dependencies
- Created index.html entry point
- Created src/main.tsx and src/App.tsx
- Configured tsconfig.json for React JSX and ESNext modules
- Created vite.config.ts with React plugin
- Created vitest.config.ts with jsdom environment for React testing
- Added @testing-library/react for component tests
- Created src/App.test.tsx with basic render test
- Updated check script to use vitest via `bun run test`
- Updated package.json with Vite scripts (dev, build, preview)

## 2026-01-13: Set up React Router v7 (bead-feeder-4lc)

Configured react-router v7 for navigation:
- Installed react-router v7.12.0
- Created src/pages/DagView.tsx for the main DAG view
- Created src/pages/IssueDetail.tsx for viewing individual issues
- Updated src/App.tsx with layout (header, nav, Outlet)
- Updated src/main.tsx with BrowserRouter and route definitions
- Routes: "/" (DAG view), "/issues/:issueId" (issue detail)
- Updated App.test.tsx to use MemoryRouter for testing

## 2026-01-14: Add React Flow library and configure (bead-feeder-60x)

Installed and configured React Flow for DAG visualization:
- Installed @xyflow/react v12.10.0
- Created src/components/DagCanvas.tsx wrapper component with Background, Controls, and MiniMap
- Updated src/pages/DagView.tsx to use DagCanvas with sample nodes/edges
- Component accepts nodes and edges props for flexible DAG rendering

## 2026-01-14: Create React Flow canvas component (bead-feeder-5ls)

Enhanced DagCanvas with proper FlowProvider setup and pan/zoom controls:
- Added ReactFlowProvider wrapper for state management (enables hooks outside ReactFlow)
- Configured useNodesState and useEdgesState for reactive node/edge updates
- Added comprehensive pan/zoom controls: panOnScroll, selectionOnDrag, zoomOnPinch, zoomOnDoubleClick
- Set zoom bounds (minZoom: 0.1, maxZoom: 4)
- Configured panOnDrag with mouse buttons [1, 2] for middle/right click panning
- Enhanced Controls component with showZoom, showFitView, showInteractive options
- Made MiniMap zoomable and pannable
- Added BackgroundVariant.Dots with configurable gap and size
- Created src/test-setup.ts with ResizeObserver mock for jsdom
- Added src/components/DagCanvas.test.tsx with tests for nodes, controls, and minimap rendering

## 2026-01-14: Create custom node component for issues (bead-feeder-be4)

Built a custom React Flow node component for displaying issues:
- Created src/components/IssueNode.tsx with IssueNodeData interface
- Displays title, status (with color-coded badge), type (with icons), and priority
- Status colors: open (blue), in_progress (amber), closed (green)
- Type icons: task (‚òê), bug (üêõ), feature (‚ú®)
- Priority colors: P0 (red), P1 (orange), P2 (yellow), P3 (gray)
- Clickable button navigates to /issues/:issueId route
- Integrated with DagCanvas via nodeTypes configuration
- Updated DagView with sample issue nodes demonstrating different states
- Added @testing-library/jest-dom for DOM matchers
- Enabled vitest globals for testing
- Created comprehensive tests in src/components/IssueNode.test.tsx

## 2026-01-14: Create API endpoint to list issues (bead-feeder-o15)

Built backend API endpoint that calls 'bd list --json' and returns issues:
- Created api/server.ts with Bun HTTP server
- GET /api/issues endpoint executes 'bd list --json' and returns JSON response
- Added CORS headers for frontend integration (Access-Control-Allow-Origin: *)
- OPTIONS preflight handler for CORS
- Error handling returns 500 with error message
- 404 for unknown routes
- Added dev:api script to package.json for running the server
- Created api/server.test.ts with integration tests (server startup, response format, CORS)

## 2026-01-14: Create API endpoint to get dependency graph (bead-feeder-8mt)

Added GET /api/graph endpoint for dependency graph data:
- Refactored runBdList to generic runBdCommand(args) function for reuse
- GET /api/graph executes 'bd graph --all --json' and returns full graph data
- Response includes Root, Issues, Dependencies, and IssueMap for each graph entry
- Dependencies array contains issue_id, depends_on_id, and type fields
- Added CORS headers consistent with /api/issues endpoint
- Added 3 integration tests: response format, CORS headers, dependency structure

## 2026-01-14: Transform issues to React Flow nodes (bead-feeder-cnl)

Created data transformer to convert beads issue data into React Flow node format:
- Created src/transformers/issueToNode.ts with BdIssue interface matching API response
- issueToNode() converts single bd issue to React Flow Node with IssueNodeData
- issuesToNodes() converts array of issues with configurable grid layout positioning
- Maps status (open/in_progress/closed), type (task/bug/feature), priority (0-3 to P0-P3)
- TransformOptions allow customizing startX/Y, spacingX/Y, and nodesPerRow
- Extended IssueNodeData interface with Record<string, unknown> for React Flow compatibility
- Added comprehensive tests in src/transformers/issueToNode.test.ts (13 tests)

## 2026-01-14: Transform dependencies to React Flow edges (bead-feeder-8jb)

Created data transformer to convert beads dependency relationships into React Flow edges:
- Created src/transformers/dependencyToEdge.ts with BdDependency interface
- dependencyToEdge() converts single dependency to React Flow Edge
- dependenciesToEdges() converts array of dependencies
- Edge direction: source = blocker (depends_on_id), target = blocked (issue_id)
- Edge ID format: `{source}-{target}` for uniqueness
- Uses smoothstep edge type for curved connections
- Added comprehensive tests in src/transformers/dependencyToEdge.test.ts (11 tests)

## 2026-01-14: Implement DAG layout algorithm (bead-feeder-8gq)

Implemented automatic hierarchical positioning of nodes using dagre:
- Installed dagre v0.8.5 and @types/dagre for TypeScript support
- Created src/transformers/dagLayout.ts with applyDagLayout() function
- Uses dagre library for hierarchical/layered graph layout algorithm
- Supports TB (top-to-bottom) and LR (left-to-right) layout directions
- Nodes with no dependencies positioned at top/left, dependents below/right
- Configurable options: direction, nodeSpacingX/Y, nodeWidth, nodeHeight
- Converts dagre center-based positions to React Flow top-left positions
- Added comprehensive tests in src/transformers/dagLayout.test.ts (11 tests)
- Tests cover: empty graphs, single nodes, TB/LR layouts, multi-level dependencies, diamond patterns, isolated nodes

## 2026-01-14: Create API endpoint to create issues (bead-feeder-02x)

Added POST /api/issues endpoint to create new issues via the API:
- POST /api/issues accepts JSON body with title, description, type, and priority fields
- title is required and must be a non-empty string (returns 400 if invalid)
- description, type, priority are optional
- Executes 'bd create' with --json flag for structured output
- Returns 201 status with created issue JSON on success
- Returns 400 for validation errors, 500 for bd command errors
- Includes CORS headers consistent with other endpoints
- Added 5 integration tests: title-only creation, full fields, missing title, empty title, CORS headers

## 2026-01-14: Add issue creation UI (bead-feeder-maj)

Built a UI for creating new issues with a floating action button and modal:
- Created src/components/CreateIssueModal.tsx with form fields for title, description, type, and priority
- Created src/components/FloatingActionButton.tsx as a circular FAB in the bottom-right corner
- Integrated both components into DagView page
- Modal features: accessible dialog with role="dialog" and aria attributes, escape key to close, backdrop click to close
- Form validates that title is required before submission
- Submits to POST /api/issues endpoint, shows error messages on failure
- Button shows "Creating..." state while submitting
- Added src/vite-env.d.ts for Vite environment type definitions (VITE_API_URL)
- Added 11 tests for CreateIssueModal covering form interactions, validation, submission, and error handling
- Added 5 tests for FloatingActionButton covering rendering and click behavior

## 2026-01-14: Create API endpoint to add dependencies (bead-feeder-5yh)

Added POST /api/dependencies endpoint for creating dependency relationships:
- POST /api/dependencies accepts JSON body with blocked and blocker issue IDs
- Both blocked and blocker are required and must be non-empty strings
- Executes 'bd dep add <blocked> <blocker> --json' to create the dependency
- Returns 201 status with created dependency JSON on success
- Returns 400 for validation errors (missing/empty blocked or blocker)
- Detects cycle errors from bd command and returns 400 with descriptive message
- Returns 500 for other bd command errors
- Includes CORS headers consistent with other endpoints
- Added 5 integration tests: successful creation, missing blocked, missing blocker, empty blocked, CORS headers

## 2026-01-14: Enable edge creation by connecting nodes (bead-feeder-360)

Configured React Flow to allow users to draw edges between nodes by dragging from handles:
- Updated DagCanvas component to accept onConnect callback prop
- Added handleConnect function that adds edge to local state for immediate visual feedback
- Uses smoothstep edge type for curved connections
- External onConnect handler is called after adding edge to state
- Updated DagView to pass onConnect handler that calls POST /api/dependencies
- Correctly maps React Flow connection (source‚Üítarget) to dependency API (blocker‚Üíblocked)
- Edge direction: drag from bottom handle (source/blocker) to top handle (target/blocked)
- Errors from API are logged to console
- Added test for DagCanvas accepting onConnect callback prop
- All 66 tests passing

## 2026-01-14: Add chat UI component (bead-feeder-mxu)

Created a chat panel component with message history, input, and markdown rendering:
- Installed react-markdown v10.1.0 for markdown rendering in assistant messages
- Created src/components/ChatPanel.tsx with ChatMessage interface
- ChatPanel accepts messages array, onSendMessage callback, and optional isLoading prop
- Message history display with empty state when no messages
- User messages styled with blue bubbles (right-aligned), assistant messages with white bubbles (left-aligned)
- Markdown rendering for assistant messages using react-markdown (supports bold, code, lists, headings, links)
- Styled code blocks with syntax highlighting colors
- Text input with placeholder and disabled state during loading
- Send button that submits on click or Enter key (Shift+Enter for new line)
- Loading indicator with animated dots when isLoading is true
- Input validation: prevents sending empty or whitespace-only messages
- Added 16 comprehensive tests in src/components/ChatPanel.test.tsx
- All 82 tests passing

## 2026-01-14: Integrate LLM API for chat (bead-feeder-juk)

Connected to Anthropic Claude API from the backend with streaming responses:
- Installed @anthropic-ai/sdk v0.71.2
- Added POST /api/chat endpoint to api/server.ts
- Accepts messages array in request body with role and content fields
- Uses claude-sonnet-4-20250514 model with 1024 max tokens
- Implements Server-Sent Events (SSE) streaming for real-time response delivery
- Streams text deltas as JSON objects with text field
- Sends [DONE] marker when stream completes
- Returns 400 for missing/empty/non-array messages
- Includes CORS headers consistent with other endpoints
- Added 4 integration tests for validation and CORS in api/server.test.ts
- All 86 tests passing (82 unit + 4 new API tests)

## 2026-01-14: Define LLM tools for graph manipulation (bead-feeder-bdg)

Created Anthropic tool definitions for LLM-driven graph manipulation:
- Created api/llm-tools.ts with 5 tool definitions for the LLM
- create_issue: Creates new issues with title (required), description, type (task/bug/feature), priority (0-3)
- add_dependency: Links issues with blocked_issue_id and blocker_issue_id
- remove_dependency: Removes dependency links between issues
- update_issue: Updates issue fields (title, description, type, priority, status, assignee)
- close_issue: Closes an issue with optional reason
- Each tool uses Anthropic Tool type with input_schema for parameter validation
- Exported llmTools array containing all 5 tools for use with the Anthropic API
- Updated vitest.config.ts to include api/**/*.test.ts for running API tests
- Added 26 comprehensive tests in api/llm-tools.test.ts covering all tool definitions
- All 129 tests passing (108 unit + 21 API server tests)

## 2026-01-14: Execute LLM tool calls and update graph (bead-feeder-zic)

Implemented LLM tool execution and real-time graph updates:
- Created api/tool-executor.ts with executeTool() function that maps tool names to bd CLI commands
- Supports all 5 tools: create_issue, add_dependency, remove_dependency, update_issue, close_issue
- Each tool executor constructs proper bd command args and returns structured results
- Updated /api/chat endpoint with full agentic loop:
  - Added SYSTEM_PROMPT with context about the beads issue tracking system
  - Configured Anthropic API to use llmTools for tool calling
  - Implemented while loop that continues until stop_reason !== 'tool_use'
  - Executes tool calls via executeTool() and feeds results back to the model
  - Sends graphUpdated event to frontend when tools were used
- Updated DagView to fetch real data from /api/graph instead of sample data
- Integrated ChatPanel into DagView with side-by-side layout
- Connected chat to /api/chat endpoint with SSE streaming
- Frontend refreshes graph when graphUpdated event is received
- Uses existing transformers (issuesToNodes, dependenciesToEdges) and applyDagLayout for visualization
- Added 7 tests in api/tool-executor.test.ts covering all tool execution paths
- All 136 tests passing

## 2026-01-14: Configure GitHub OAuth app (bead-feeder-bnd)

Set up environment configuration for GitHub OAuth authentication:
- Updated .gitignore to include .env, .env.local, and .env.*.local patterns
- Created .env.example with documented environment variables:
  - GITHUB_CLIENT_ID: OAuth app client ID
  - GITHUB_CLIENT_SECRET: OAuth app client secret (keep secret!)
  - GITHUB_OAUTH_SCOPES: Optional, defaults to "repo"
  - PORT: API server port (default 3001)
  - VITE_API_URL: Frontend API URL
  - VITE_GITHUB_CLIENT_ID: Client ID for frontend OAuth flow
- Documented required OAuth scopes: "repo" for full control of private repositories
- Documented OAuth app registration steps with callback URL
- Updated src/vite-env.d.ts with VITE_GITHUB_CLIENT_ID type definition
- All 136 tests passing

## 2026-01-14: Implement GitHub OAuth login flow (bead-feeder-dl9)

Implemented full GitHub OAuth authentication flow with secure token storage:
- Created src/components/GitHubLoginButton.tsx component with GitHub icon and OAuth redirect
- Generates random state parameter for CSRF protection stored in sessionStorage
- Created src/pages/AuthCallback.tsx to handle GitHub OAuth callback
- Validates state parameter and exchanges authorization code for access token
- Added POST /api/auth/github/callback endpoint to exchange code for GitHub access token
- Added GET /api/auth/me endpoint to check current authentication status via cookie
- Added POST /api/auth/logout endpoint to clear the auth cookie
- Stores access token in secure httpOnly cookie (Max-Age: 24 hours)
- Created src/context/AuthContext.tsx for React auth state management
- AuthProvider fetches user on mount, provides user/logout/refreshUser to children
- Updated src/App.tsx header to show login button or user avatar/name with logout
- Updated src/main.tsx with AuthProvider wrapper and /auth/callback route
- Added CORS credentials support for cross-origin cookie handling
- Added 6 auth-related API tests and 5 GitHubLoginButton component tests
- Added 5 AuthContext tests covering user fetching and error handling
- All 152 tests passing

## 2026-01-14: Fix linting warnings in test files (bead-feeder-lf5)

Fixed 16 lint warnings for non-null assertions in test files:
- Fixed src/components/ChatPanel.test.tsx: replaced `form!` with null check and type cast
- Fixed src/transformers/dagLayout.test.ts: created `findNodeById` helper function to replace all 15 non-null assertions
- Helper function throws descriptive error if node not found, improving test failure messages
- All 152 tests passing with zero lint warnings

## 2026-01-14: Clean up test artifact issues (bead-feeder-7j9)

Removed test artifact issues created by API and tool executor integration tests:
- Closed 68 test issues with titles: "Test Full Issue", "Full Tool Executor Test Issue", "CORS Test Issue", "Dep Test Issue 2", "Test API Issue"
- These were orphaned issues created during integration testing of the bd CLI tools
- Issue tracker now shows only real work items (2 remaining tasks)
- Ready queue clean with legitimate tasks: "Create authenticated git operations service" and "Add repository selector UI"

## 2026-01-14: Create authenticated git operations service (bead-feeder-226)

Built a git operations service that uses GitHub access tokens for authenticated git operations:
- Created api/git-service.ts with the following functions:
  - parseGitHubUrl(): Parses GitHub URLs (HTTPS, SSH, and short form owner/repo)
  - buildAuthenticatedUrl(): Constructs authenticated URL with x-access-token
  - cloneRepository(): Clones a GitHub repo using access token authentication
  - fetchRepository(): Fetches updates from remote with temporary auth URL injection
  - pushRepository(): Pushes to remote using authenticated URL
  - pullRepository(): Pulls from remote using authenticated URL
  - listUserRepositories(): Fetches user's repos from GitHub API
  - getCurrentBranch(): Gets the current git branch name
  - getStatus(): Gets git status (porcelain format)
  - isGitRepository(): Checks if directory is a git repo
- Auth URL injection pattern: temporarily sets remote URL with token, performs operation, restores original URL
- This keeps tokens out of git config and history
- Added 13 comprehensive tests in api/git-service.test.ts
- Also cleaned up 12 more test artifact issues from the issue tracker
- All 165 tests passing

## 2026-01-14: Add repository selector UI (bead-feeder-3e5)

Built a repository selector UI that shows after login and filters repos by .beads presence:
- Added GET /api/repos endpoint to list user's GitHub repositories (uses listUserRepositories from git-service)
- Added GET /api/repos/:owner/:repo/has-beads endpoint to check if a repo has a .beads directory
- Both endpoints require authentication via httpOnly cookie and return 401 if not authenticated
- Created src/components/RepositorySelector.tsx component:
  - Fetches user's repos on mount and checks each for .beads directory
  - Separates repos into "Repositories with Beads" and "Other Repositories" sections
  - Shows loading state, error state with retry button
  - Displays repo owner/name and default branch
  - Clicking a repo calls onSelect callback
- Created src/pages/Home.tsx:
  - Shows welcome card with GitHub login button when not authenticated
  - Shows RepositorySelector when authenticated
  - Navigates to /repos/:owner/:repo on repo selection
- Updated routing in main.tsx:
  - Home page at "/" shows login or repo selector
  - DagView moved to "/repos/:owner/:repo"
- Updated App.tsx header:
  - Title now links to home page
  - Shows breadcrumb with owner/repo when on a repo page
- Added helper function getTokenFromCookies() in server.ts for reuse
- Added 7 tests for RepositorySelector component
- Cleaned up 20 test artifact issues from the issue tracker
- All 172 tests passing

## 2026-01-14: Implement background job queue for sync (bead-feeder-ksp)

Created a background job queue for git sync operations:
- Created api/sync-queue.ts with SyncQueue class for managing git sync operations
- Queue supports three job types: commit, push, and pull
- Debounces rapid commit requests to avoid excessive git operations (configurable, default 2000ms)
- Periodic push interval to sync changes to remote (configurable, default 30000ms)
- Event system with statusChange, syncComplete, and syncError events
- Token management for authenticated git operations via setToken/getToken
- State tracking with SyncQueueState interface (status, pendingJobs, lastSync, lastError)
- Singleton pattern with getSyncQueue() and resetSyncQueue() functions
- Commit operation stages .beads directory and commits only if there are changes
- Push and pull operations use git-service for authenticated operations
- Added 16 comprehensive tests in api/sync-queue.test.ts
- Cleaned up 19 test artifact issues from the issue tracker
- All 188 tests passing

## 2026-01-14: Add sync status indicator (bead-feeder-zyf)

Added UI components for sync status display with toast notifications:
- Created src/components/SyncStatusIndicator.tsx with visual status indicator
  - Displays four states: synced (green), syncing (blue animated), pending (amber), error (red)
  - Shows relative time since last sync ("just now", "5m ago", "2h ago")
  - Tooltip shows error message when in error state
- Created src/components/Toast.tsx with ToastContainer for notifications
  - Supports success, error, and info toast types with appropriate styling
  - Auto-dismisses after 5 seconds with fade animation
  - Manual dismiss button available
- Created src/context/SyncContext.tsx for global sync state management
  - Subscribes to /api/sync/events SSE endpoint for real-time updates
  - Provides status, lastSyncTime, errorMessage, and toast management
  - Auto-shows toasts on sync completion or error
- Added GET /api/sync/events SSE endpoint to api/server.ts
  - Streams sync queue state changes in real-time
  - Sends initial state on connection
  - Subscribes to statusChange, syncComplete, and syncError events
  - Includes heartbeat to keep connection alive
- Integrated SyncProvider in main.tsx
- Added SyncStatusIndicator to App header (visible when viewing a repo)
- Added ToastContainer to App for global notifications
- Fixed flaky test for GET /api/graph that expected Dependencies to always be an array
- Added 8 tests for SyncStatusIndicator
- Added 9 tests for Toast component
- Cleaned up test artifact issues from issue tracker
- All 205 tests passing

## 2026-01-14: Handle sync conflicts and errors (bead-feeder-7d9)

Implemented git conflict detection, retry with exponential backoff, and conflict resolution UI:
- Added conflict detection functions to api/git-service.ts:
  - compareBranches(): Returns ahead/behind counts and diverged status
  - hasConflicts(): Checks for merge conflicts in working directory
  - abortMerge(): Aborts an in-progress merge
  - resolveConflictsTheirs(): Accept all remote changes
  - resolveConflictsOurs(): Accept all local changes
- Updated api/sync-queue.ts with conflict handling:
  - Added 'conflict' status to SyncStatus type
  - Added conflictInfo to SyncQueueState (ahead/behind counts)
  - Added 'conflict' event type for notifying frontend
  - Implemented retry with exponential backoff (configurable maxRetries, retryBaseDelayMs)
  - Push now fetches first, checks if behind remote, auto-pulls if not diverged
  - Detects conflicts during push/pull and emits conflict events
  - Added enqueueResolve() method with 'theirs', 'ours', 'abort' strategies
  - Added clearConflict() to reset conflict state after resolution
- Updated src/components/SyncStatusIndicator.tsx:
  - Added 'conflict' status with red indicator
  - Shows ahead/behind counts when in conflict state
  - Shows Pull/Abort buttons with onResolve callback
- Updated src/context/SyncContext.tsx:
  - Added conflictInfo state and resolveConflict function
  - Handles conflict events from SSE endpoint
  - Shows toast notifications on conflict
- Added POST /api/sync/resolve endpoint to api/server.ts:
  - Accepts resolution: 'theirs' | 'ours' | 'abort'
  - Requires authentication via cookie
  - Triggers sync queue conflict resolution
- Updated /api/sync/events SSE endpoint to emit conflict events
- Added 19 new tests:
  - 3 tests for git-service conflict detection functions
  - 7 tests for sync-queue conflict handling and enqueueResolve
  - 5 tests for SyncStatusIndicator conflict UI
  - 4 tests for /api/sync/resolve endpoint
- Cleaned up 16 test artifact issues from issue tracker
- All 224 tests passing

## 2026-01-14: Pass repository context to graph API (bead-feeder-6w9)

Updated the graph API to fetch issues from selected GitHub repositories:
- Updated src/pages/DagView.tsx:
  - Added useParams hook to extract owner/repo from URL params
  - Modified fetchGraph() to accept optional owner/repo parameters
  - Builds URL with query params when owner/repo provided
  - Added credentials: 'include' for cookie authentication
  - Added react-router-dom dependency (v7.12.0)
- Updated api/server.ts /api/graph endpoint:
  - Accepts optional owner and repo query parameters
  - When params provided: requires authentication, fetches .beads/issues.jsonl via GitHub Contents API
  - Decodes base64 content and parses JSONL format
  - Filters out tombstone issues
  - Returns empty array on 404 (no issues file)
  - When no params: keeps existing local bd graph behavior
- Created api/buildGraphsFromIssues.ts module:
  - Exported BdIssue, BdDependency, GraphApiResponse interfaces
  - buildGraphsFromIssues() transforms issues array to GraphApiResponse format
  - Builds dependency relationships from issue dependencies arrays
  - Identifies root issues (no incoming dependencies)
  - Creates one graph entry per root issue
- Added api/buildGraphsFromIssues.test.ts with 9 tests:
  - Empty input, single issue, dependencies, root identification
  - Multiple roots, multiple dependencies, IssueMap building
  - Property preservation, circular dependency handling
- Added 3 tests to api/server.test.ts for /api/graph with owner/repo:
  - Returns 401 without authentication
  - Includes CORS credentials headers
  - Falls back to local bd command when no params
- All 236 tests passing

## 2026-01-14: Add logging to API (bead-feeder-trx)

Added structured logging to the API server:
- Created api/logger.ts with logging utility module
- Support for log levels: debug, info, warn, error (configurable via LOG_LEVEL env var)
- logRequest() function for HTTP request logging with method, path, status, duration
- Log format: [timestamp] [LEVEL] message method path -> status (duration)
- Status-based log levels: 2xx/3xx=info, 4xx=warn, 5xx=error
- Wrapped server fetch handler to log all requests with timing
- Skips logging for OPTIONS preflight and SSE event stream endpoints
- Catches unhandled errors and logs them with error level
- Added 8 tests in api/logger.test.ts covering all log functions
- Fixed 2 failing tests from previous session (OAuth configuration now present in .env)
- Cleaned up ~30 test artifact issues created by integration tests
- All 244 tests passing

## 2026-01-14: Clean up test artifact issues (maintenance)

Closed 18 test artifact issues that accumulated from API and tool executor integration tests:
- Issues had titles like "Test Full Issue", "Full Tool Executor Test Issue", "CORS Test Issue", "Dep Test Issue", "Test API Issue", "Tool Executor Test Issue"
- Issue tracker is now clean with no open issues
- All 244 tests still passing
- Ready for next feature work

## 2026-01-14: Make 'dev' run both servers with single output (bead-feeder-6s0)

Created a combined dev script that runs both Vite and API servers with merged output:
- Created scripts/dev.ts using Bun's spawn API to run both processes
- Output is prefixed with colored labels: [vite] in cyan, [api] in magenta
- Both stdout and stderr streams are captured and prefixed
- Handles process termination gracefully (SIGINT/SIGTERM cleanup)
- Updated package.json scripts:
  - "dev" now runs scripts/dev.ts (combined servers)
  - "dev:vite" runs vite only
  - "dev:api" runs API server only
- All 244 tests passing

## 2026-01-14: Clean up test artifact issues (maintenance)

Closed 17 test artifact issues that accumulated from API and tool executor integration tests:
- Issues had titles: "Test Full Issue", "Full Tool Executor Test Issue", "CORS Test Issue", "Dep Test Issue 1/2", "Test API Issue", "Tool Executor Test Issue"
- These were orphaned issues created during integration testing runs
- Issue tracker is now clean with no open issues
- All 244 tests still passing
- Ready for next feature work

## 2026-01-14: Stop creating test issues in local repository (bead-feeder-8og)

Fixed integration tests to stop creating real issues in the local beads repository:
- Refactored api/tool-executor.test.ts to mock the node:child_process spawn function
  - Used vi.hoisted() to create mock before vi.mock() hoisting
  - Created mockSpawnSuccess() and mockSpawnFailure() helpers for test setup
  - Tests now verify bd CLI calls without actually executing them
  - Increased test coverage with positive test cases for all tool operations
- Refactored api/server.test.ts to only test validation paths
  - Removed tests that create actual issues (POST /api/issues success cases)
  - Removed tests that create dependencies (POST /api/dependencies success cases)
  - Kept validation tests (400 errors for missing/empty fields) since they don't create issues
  - Added explanatory comments about why success path tests were removed
- Cleaned up 10 existing test artifact issues from previous test runs
- All 245 tests passing (net +1 test from additional tool-executor coverage)
- Issue tracker now stays clean when running tests

## 2026-01-14: Add Playwright script to sign into GitHub (bead-feeder-dh7)

Created a Playwright test script for GitHub authentication e2e testing:
- Added @playwright/test as dev dependency (v1.57.0)
- Installed Chromium browser and system dependencies for Playwright
- Created e2e/github-login.spec.ts with GitHub login test:
  - Reads credentials from TEST_GITHUB_USERNAME and TEST_GITHUB_PASSWORD env vars
  - Navigates to github.com/login and fills in credentials
  - Handles 2FA detection (takes screenshot at 2FA prompt if encountered)
  - Verifies successful login by checking for user avatar/profile elements
  - Takes full-page screenshot of authenticated state
- Created playwright.config.ts with Chromium project configuration
- Added TEST_GITHUB_USERNAME and TEST_GITHUB_PASSWORD to .env.example with documentation
- Added "test:e2e:login" script to package.json to run the test
- Created e2e/ and screenshots/ directories
- Added test-results and screenshots to .gitignore
- All 245 existing tests still passing

## 2026-01-14: E2E test: Load beads issues from GitHub repository (bead-feeder-uko)

Created Playwright e2e test that verifies the full flow of signing into GitHub and loading beads issues:
- Created e2e/load-beads-issues.spec.ts with comprehensive test flow:
  - Step 1: Signs into GitHub using TEST_GITHUB_USERNAME and TEST_GITHUB_PASSWORD env vars
  - Step 2: Navigates to the Bead Feeder app and clicks the GitHub login button
  - Step 3: Handles GitHub OAuth authorization (clicks Authorize if first time)
  - Step 4: Selects the test repository from the repository selector
  - Step 5: Verifies issue nodes are displayed in the DAG view
- Test uses configurable TEST_GITHUB_REPOSITORY env var (defaults to josh-beads-test-1/bead-feeder-example-issues)
- Detects 2FA and fails with helpful error message if encountered
- Takes success screenshot to screenshots/e2e-issues-loaded.png on completion
- Playwright config already has screenshot: 'only-on-failure' for automatic failure screenshots
- Added "test:e2e:load-issues" script to package.json
- Added TEST_GITHUB_REPOSITORY to .env.example with documentation
- All 245 tests still passing

## 2026-01-14: Add Claude Code vision verification to E2E test

Enhanced the load-beads-issues E2E test to verify screenshots using Claude Code CLI:
- Created e2e/verify-screenshot.ts utility that invokes `claude -p` to analyze screenshots
- Test now always takes a screenshot on success and verifies it shows issues
- Claude vision verification confirms:
  - Screenshot contains visible issue nodes
  - Reports count of issues found
  - Provides description of what's visible
- Updated test to fail if Claude cannot verify issues are displayed
- Note: 2 pre-existing test failures in server.test.ts (GET /api/graph tests) - these were failing before this change

## 2026-01-14: Use sans-serif font in UI (bead-feeder-q62)

Updated the UI to use a sans-serif font for better readability:
- Added font-family style to body element in index.html
- Uses system font stack: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif
- Also added margin: 0 to remove default body margin
- All 245 tests passing

## 2026-01-14: Add single command to run all e2e tests (bead-feeder-22z)

Created a unified e2e test runner that starts servers and runs all Playwright tests:
- Created scripts/e2e.ts that manages the full e2e test lifecycle
- Starts dev servers (vite + API) using existing scripts/dev.ts
- Waits for both servers to be ready (polls endpoints with timeout)
- Runs all Playwright tests via `bunx playwright test`
- Cleans up servers after tests complete (success or failure)
- Added "test:e2e" script to package.json for convenient one-command execution
- Usage: `bun run test:e2e` starts servers, runs all e2e tests, shuts down
- All 245 tests passing

## 2026-01-14: Connect boxes in Dag view for dependent issues (bead-feeder-doh)

Fixed DAG view to properly display edges between dependent issues:
- Added `/local` route to main.tsx for viewing local beads DAG without GitHub authentication
- Fixed CORS issue in DagView.tsx: fetchGraph was using `credentials: 'include'` for all requests
- When credentials are included, CORS requires a specific origin (not wildcard `*`)
- Now only includes credentials when fetching from GitHub repos (when owner/repo params are present)
- Local graph endpoint (`/api/graph` without params) no longer fails due to CORS
- Edges between dependent issues now render correctly as smooth-step lines
- Visual verification: parent issues connect to child issues with visible lines showing dependency relationships
- All 245 tests passing

## 2026-01-14: Remove Claude verification from e2e test (bead-feeder-704)

Made e2e test deterministic by removing AI verification:
- Removed import and usage of verifyScreenshotShowsIssues from e2e/load-beads-issues.spec.ts
- Deleted e2e/verify-screenshot.ts utility that invoked Claude CLI for screenshot analysis
- Test now relies solely on Playwright assertions for DOM state verification
- Screenshot is still taken on success for manual review if needed
- All 245 tests passing

## 2026-01-15: Add debug logging to DAG rendering code (bead-feeder-yjy)

Added permanent debug logging throughout the DAG rendering pipeline:
- Created src/utils/dagLogger.ts with logging utilities:
  - dagLog(): Debug-level logging, enabled via localStorage.setItem('DAG_DEBUG', 'true')
  - dagWarn(): Warning-level logging (always visible)
  - dagError(): Error-level logging (always visible)
  - logGraphSummary(): Logs issue/dependency/node/edge counts
  - logLayoutComputed(): Logs layout timing and configuration
- Added logging to src/transformers/issueToNode.ts:
  - Warns on unknown status, type, or priority values with defaults used
  - Logs node creation with IDs and positions
- Added logging to src/transformers/dependencyToEdge.ts:
  - Logs edge creation with connections
  - Warns on invalid edges with missing source/target
- Added logging to src/transformers/dagLayout.ts:
  - Logs layout computation with timing (performance.now())
  - Warns on skipped edges due to missing nodes
  - Logs final node positions
- Added logging to src/pages/DagView.tsx:
  - Logs graph fetch URL, response, and processing steps
  - Logs state updates when nodes/edges change
- Added logging to src/components/DagCanvas.tsx:
  - Logs render with node/edge counts
  - Logs prop syncing and new connections
- All 245 tests passing

## 2026-01-15: Clone test repo into temp directory (bead-feeder-2lh)

Added functionality to clone the test repository into a temporary directory in the e2e test:
- Added imports for execSync, fs, os, and path in e2e/load-beads-issues.spec.ts
- Created cloneTestRepo() function that:
  - Creates a unique temp directory using fs.mkdtempSync()
  - Builds an authenticated GitHub URL with URL-encoded credentials
  - Clones the repo using git clone via execSync
  - Returns the path to the cloned repository
  - Cleans up temp directory on failure
- Created cleanupClonedRepo() function to remove the cloned directory
- Added test.afterAll() hook to clean up the cloned repo after tests complete
- Added "Clone test repository to temp directory" test step that runs before GitHub authentication
- Verifies the .beads directory exists in the cloned repo (with warning if not found)
- Module-scoped clonedRepoPath variable stores the path for use by subsequent test steps
- All 245 tests passing

## 2026-01-15: Extract issues and dependencies from cloned repo using beads CLI (bead-feeder-5g3)

Added functionality to extract beads data from the cloned test repository using CLI commands:
- Defined interfaces for extracted data: BeadsIssue, BeadsDependency, BeadsData
- Created extractBeadsData() function that:
  - Runs `bd list --json` in the cloned repo directory to get all issues
  - Runs `bd graph --all --json` to get all dependency relationships
  - Collects unique dependencies using Map to avoid duplicates
  - Returns structured data with issues array and dependencies array
- Added new test step "Extract issues and dependencies from cloned repo" that:
  - Calls extractBeadsData() after cloning the repo
  - Logs the number of issues and dependencies found
  - Logs each issue ID, title, and status for debugging
  - Logs each dependency relationship (blocker blocks blocked)
  - Asserts at least one issue exists in the test repository
  - Asserts at least one dependency relationship exists
- Added module-scoped extractedBeadsData variable for later comparison with DAG view
- All 245 tests passing

## 2026-01-15: Extract issues and dependencies data structure from DAG view (bead-feeder-3fw)

Added functionality to extract issues and dependencies from the DAG view UI for comparison with CLI data:
- Added data attributes to IssueNode component for easier DOM extraction:
  - data-issue-id: The issue ID
  - data-issue-status: The issue status (open, in_progress, closed)
  - data-issue-type: The issue type (task, bug, feature)
  - data-issue-priority: The issue priority (P0, P1, P2, P3)
- Defined new interfaces in e2e test file: DagIssue, DagDependency, DagData
- Added module-scoped extractedDagData variable to store extracted data
- Added new test step "Extract issues and dependencies from DAG view" that:
  - Iterates over all issue nodes using data-testid="issue-node" selector
  - Extracts id, title, status, priority, and issue_type from data attributes
  - Extracts dependencies from React Flow edges using .react-flow__edge selector
  - Gets source (blocker) and target (blocked) from edge data attributes
  - Logs extracted counts and details for debugging
  - Asserts at least one issue was extracted from the DAG view
- Data structure mirrors BeadsData for later comparison
- All 245 tests passing

## 2026-01-15: Compare CLI and DAG data structures in test assertion (bead-feeder-hpi)

Added final test step to compare beads CLI data with DAG view data:
- Added "Compare CLI and DAG data structures" test step to e2e/load-beads-issues.spec.ts
- Comparison verifies all CLI issues appear in DAG view
- Compares issue properties: status, issue_type, and priority
- Priority normalization: CLI uses numbers (0-3), DAG uses strings (P0-P3)
- Status and type normalization: case-insensitive comparison
- Compares all dependency relationships between CLI and DAG data
- Creates lookup map for efficient issue-by-id access
- Logs any missing issues, mismatched properties, or missing dependencies
- Assertions fail with descriptive messages if data doesn't match
- Successfully logs "‚úì All CLI issues and dependencies match DAG view" on pass
- All 245 tests passing

## 2026-01-15: Fix E2E test race condition between sync and DAG rendering (bead-e71)

Fixed intermittent e2e test failure where issues don't appear in DAG view after sync completes:
- Root cause: Test was waiting for 'Synced' text (git sync status) but this is independent of graph data fetch
- Graph data is fetched via separate useEffect in DagView, creating a race condition
- Fixed by waiting for actual issue nodes to appear instead of sync status
- Changed test step 'Verify DAG view loaded' to wait for '[data-testid="issue-node"]' first visible
- Increased timeout to 30000ms to allow time for graph fetch and rendering
- Removed unreliable 'Synced' status check which was causing false positives
- All 245 tests passing

## 2026-01-15: Delete redundant github-login.spec.ts (bead-r4u)

Deleted the redundant e2e/github-login.spec.ts file:
- The github-login.spec.ts test only signed into GitHub and took a screenshot
- This functionality is already covered by e2e/load-beads-issues.spec.ts which:
  - Signs into GitHub (Step 1)
  - Completes the full OAuth flow with the Bead Feeder app
  - Verifies issues load in the DAG view
- Removed the duplicate test file to avoid maintenance overhead
- All 245 tests still passing

## 2026-01-15: Add playwright tests to ./check script (bead-869)

Updated the ./check quality gates script to run playwright e2e tests:
- Added `bun run test:e2e` to the end of the ./check script
- Now ./check runs: build, lint, unit tests, and e2e tests
- E2e tests use scripts/e2e.ts to start dev servers and run all playwright tests
- Note: E2e tests currently fail due to pre-existing bug (bead-8k7) where dependency edges don't render for remote repos
- Created P1 bug issue bead-8k7 to track the edge rendering problem
- All 245 unit tests still passing

## 2026-01-15: Fix DAG view dependency edges for remote repos (bead-8k7)

Fixed the P1 bug where DAG view did not render dependency edges for remote repositories:

**Root Cause:**
- The `buildGraphsFromIssues` function expected `dependencies` to be an array of string IDs
- But `issues.jsonl` stores dependencies as full objects with fields: `issue_id`, `depends_on_id`, `type`, `created_at`, `created_by`
- This mismatch caused all dependencies to be silently ignored

**Fixes Applied:**
1. Updated `api/buildGraphsFromIssues.ts`:
   - Added `IssueDependencyObject` interface for the object format
   - Updated `BdIssue.dependencies` type to accept both string[] and object[] formats
   - Modified dependency extraction logic to handle both formats
   - Added 2 new tests for object format and mixed format dependencies

2. Updated `e2e/load-beads-issues.spec.ts`:
   - Fixed edge extraction to use React Flow v12's `aria-label` attribute
   - React Flow v12 uses `aria-label="Edge from {source} to {target}"` not `data-source`/`data-target`
   - Added console logging for edge count debugging

**Results:**
- All 247 unit tests passing (2 new tests added)
- E2e test now passes: extracts 10 issues and 12 dependencies correctly
- DAG view displays hierarchical layout with visible edges between dependent issues
- ./check quality gates fully pass (build, lint, unit tests, e2e tests)

## 2026-01-15: Reduce spacing between issues in DAG view (bead-p5d)

Reduced the node spacing in the DAG layout to make the view more compact:
- Updated src/transformers/dagLayout.ts DEFAULT_OPTIONS
- Changed nodeSpacingX from 50 to 20
- Changed nodeSpacingY from 50 to 20
- This reduces the horizontal and vertical gap between issue nodes by 60%
- More issues now visible in the same viewport area
- All 247 tests passing, e2e test passes

## 2026-01-15: Show issue detail in modal instead of replacing DAG view (bead-2wl)

Clicking an issue node now opens a modal overlay instead of navigating away from the DAG view:
- Created src/components/IssueDetailModal.tsx component:
  - Displays issue title, ID, status, type with icon, and priority
  - Status colors match IssueNode (open=blue, in_progress=amber, closed=green)
  - Type displayed with icons (task=‚òê, bug=üêõ, feature=‚ú®)
  - Priority shows full label (P0 - Critical, P1 - High, etc.)
  - Close via X button, Close button, backdrop click, or Escape key
  - Accessible with role="dialog" and aria attributes
- Updated src/components/IssueNode.tsx:
  - Removed router navigation on click
  - Added optional onSelect callback to IssueNodeData interface
  - Click now calls onSelect(issueData) if provided
- Updated src/pages/DagView.tsx:
  - Added selectedIssue state and handleIssueSelect callback
  - Injects onSelect callback into each node's data during graph refresh
  - Integrated IssueDetailModal that opens when an issue is selected
- Updated src/components/IssueNode.test.tsx:
  - Removed router navigation test and mock
  - Added tests for onSelect callback behavior
- Created src/components/IssueDetailModal.test.tsx with 14 tests:
  - Tests for rendering, display of all issue properties
  - Tests for all close mechanisms (X button, Close button, backdrop)
  - Tests for different status, type, and priority variants
- All 262 tests passing, e2e test passes

## 2026-01-15: Fix git service tests corrupting local .git/config (bead-b52)

Fixed the bug where running tests via ./check corrupted the local .git/config file:

**Root Cause:**
- The sync-queue tests (api/sync-queue.test.ts) set test tokens and called enqueuePush/enqueuePull
- These operations triggered git-service functions (fetchRepository, pushRepository, pullRepository)
- These functions temporarily set the remote URL with the auth token, performed the operation, and restored it
- However, since cwd defaulted to process.cwd() (the actual project directory), the real .git/config was being modified
- If a test failed or the restore step didn't complete, the config was left corrupted with token in the URL

**Fix Applied:**
- Updated api/sync-queue.test.ts to mock all git-service functions using vi.hoisted() and vi.mock()
- Mocked functions: fetchRepository, pushRepository, pullRepository, compareBranches, getCurrentBranch, hasConflicts, abortMerge, resolveConflictsTheirs
- All mocks return success values by default
- Added vi.clearAllMocks() and mock reset logic in beforeEach
- Tests no longer execute real git operations against the project directory

**Note:**
- git-service.test.ts was left unchanged as it only tests read-only operations (isGitRepository, getCurrentBranch, getStatus, compareBranches, hasConflicts) which don't modify .git/config
- All 262 tests passing, e2e test passes

## 2026-01-15: Remove slow beads repository detection at startup (bead-zgj)

Removed the behavior that checks each repository for a .beads directory at startup:

**Changes:**
- Removed GET /api/repos/:owner/:repo/has-beads endpoint from api/server.ts
- Simplified src/components/RepositorySelector.tsx:
  - Removed checkBeadsDirectory() function and related state (checkingBeads)
  - Removed RepositoryWithBeads interface (repos no longer track hasBeads)
  - Removed the dual-section UI (Repositories with Beads / Other Repositories)
  - Now displays a single flat list of all repositories
  - Removed unused styles: checkingIndicator, repoButtonSecondary
- Updated src/components/RepositorySelector.test.tsx:
  - Removed test for separating repos with/without beads
  - Simplified fetch mocks (no longer need to mock has-beads endpoint)
  - Updated onSelect expectation to not include hasBeads property

**Impact:**
- Repository list now loads instantly after fetching repos (no N+1 API calls)
- Users can still select any repository and view issues (issues are fetched on demand when viewing)
- All 261 tests passing, e2e test passes

## 2026-01-15: Use a horizontal dagre layout with React Flow (bead-5a9)

Changed the DAG layout default direction from top-to-bottom (TB) to left-to-right (LR):
- Updated src/transformers/dagLayout.ts DEFAULT_OPTIONS.direction from 'TB' to 'LR'
- Updated the JSDoc comment for the direction option to reflect the new default
- Nodes with no dependencies now appear on the left, dependent nodes appear to the right
- This creates a horizontal flow that is easier to read and follows the conventional direction of dependency graphs
- All 261 tests passing, e2e test passes

## 2026-01-15: Make dependencies connect at left/right of cards (bead-0bl)

Changed edge connection points to match horizontal (LR) layout direction:
- Updated src/components/IssueNode.tsx Handle positions
- Changed target Handle from Position.Top to Position.Left
- Changed source Handle from Position.Bottom to Position.Right
- Edges now connect horizontally: blockers on the left, blocked issues on the right
- Edges already use smoothstep type (curved lines) - no change needed
- All 261 tests passing, e2e test passes

## 2026-01-15: Make cards in the DAG view have uniform width (bead-h0o)

Set a fixed width on issue cards for consistent visual appearance:
- Updated src/components/IssueNode.tsx button style
- Changed from minWidth: '180px', maxWidth: '250px' to width: '250px'
- Width matches the nodeWidth (250px) used in dagLayout.ts for dagre positioning
- All cards now render at exactly the same width regardless of title length
- All 261 tests passing, e2e test passes

## 2026-01-15: Use shadcn/ui components where possible (bead-ulz)

Adopted shadcn/ui component library for consistent styling and improved maintainability:

**Setup:**
- Installed Tailwind CSS v4 with @tailwindcss/vite plugin
- Configured path aliases in tsconfig.json (@/ -> ./src) and vite.config.ts
- Ran `bunx shadcn@latest init` to set up shadcn/ui configuration
- Added shadcn/ui components: button, dialog, input, label, select, textarea, badge, sonner, card
- Created src/index.css with Tailwind imports and CSS variables for theming
- Updated vitest.config.ts with path alias for test resolution

**Component Migrations:**
1. CreateIssueModal.tsx:
   - Replaced custom modal with shadcn/ui Dialog component
   - Used Button (primary/outline variants), Input, Label, Select, Textarea
   - Replaced inline styles with Tailwind utility classes
   - Maintained all existing functionality and test IDs
   - Updated tests to work with Radix UI Dialog behavior

2. IssueDetailModal.tsx:
   - Replaced custom modal with shadcn/ui Dialog component
   - Used Button (outline), Badge for status display
   - Replaced inline styles with Tailwind classes
   - Status badges use custom background colors via className
   - Priority uses text color classes
   - Updated tests for new component structure

**Configuration:**
- Updated biome.json to exclude CSS files (Tailwind v4 syntax not supported by biome CSS parser)

**Test Updates:**
- Removed 2 tests for backdrop click (now handled internally by Radix Dialog)
- Updated close button tests to work with shadcn/ui Dialog X button
- All other tests preserved and passing

**Results:**
- 259 unit tests passing
- E2e test passes
- Build, lint, and all quality gates pass
